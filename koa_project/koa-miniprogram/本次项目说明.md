server的启动：
node app.js NODE_ENV='dev' 端口：4001
mongoose的启动： mongodb://127.0.0.1:27017/
本次用的数据库名叫: xcx
用户： admin  or test
默认nginx配置nginx.conf，添加：#include /usr/local/openresty/nginx/conf/conf.d/*.conf
conf文件夹下创建conf.d文件夹，
添加四个文件


项目放在服务器的: /data/apps
nginx的日志路径： /usr/local/openresty/nginx/logs

koa-index-web
	/koa-admin-web 后台管理
	/koa-service  接口 
	/miniprogram  小程序
  /koa-index-web


后台系统：
1. 生成二维码[qrcode包含id,创建时间，加密码]
（用户在此期间或扫描二维码，调用扫码登录接口，扫码登录接口中如果有x-session字段，就给该qrcode和sessionkey绑定到code的集合中）
2. 每10秒轮询调用后端的二维码验证api，如果成功就给cookie中设置token，token的值是sessionkey
```
  后端二维码验证api每10s轮询一次，从数据库中查看code字段的seesionkey属性是否存在
  生成二维码的接口，code字段会在30s后从数据库移除，code的结构为{sessionkey: '', code: ''}
```
3.调用后端的用户信息查询接口并发送x-session字段。如果api调用成功，如果是管理员就跳转到相册页面
```
  后端通过x-session判断用户的角色，x-session只有后端二维码验证api成功生成cookie的token字段才能生效
```
4.扫码调用二维码登录页面，发送x-session字段，x-session字段的信息是onauth授权后
后端调用二维码绑定用户接口，将code字段更新，添加sessionkey属性。

小程序系统outh机制：
  用户访问小程序，后者将前者导向认证服务器
  用户选择是否给予小程序授权
  假设用户给予授权，认证服务器将用户导向小程序事先指定的"重定向URI"，同时附上一个授权码code
  收到授权码，附上早先的"重定向URI"，向认证服务器申请令牌,拿到openid,利用openid创建用户到数据库，
  并用创建用户的用户id生成一个sessionkey.这个sessionkey就是以后登录信息中cookie的token属性的值，
  之后客户端调用接口就会携带x-session字段，另外sessionkey会过期，过期时间为3天

注意：同域名不同端口部署的应用cookie共用,浏览器的实现：“cookie区分域，而不区分端口”，不过根据同源策略cookie本身是区分端口的。
